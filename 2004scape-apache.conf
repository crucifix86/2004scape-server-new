<VirtualHost *:80>
    # If you have a domain name, uncomment and update these:
    # ServerName yourdomain.com
    # ServerAlias www.yourdomain.com
    
    # Proxy settings for Node.js app
    ProxyRequests Off
    ProxyPreserveHost On
    
    # Main website proxy
    ProxyPass / http://localhost:8888/
    ProxyPassReverse / http://localhost:8888/
    
    # WebSocket support for the game
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:8888/$1" [P,L]
    
    # Proxy headers
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"
    RequestHeader set X-Real-IP %{REMOTE_ADDR}s
    RequestHeader set X-Forwarded-For %{REMOTE_ADDR}s
    
    # Timeouts for long-running connections (game sessions)
    ProxyTimeout 300
    ProxyBadHeader Ignore
    
    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/2004scape-error.log
    CustomLog ${APACHE_LOG_DIR}/2004scape-access.log combined
</VirtualHost>